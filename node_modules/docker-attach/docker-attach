#!/usr/bin/env node

/**
 * Module dependencies.
 */

var spawn = require('child_process').spawn;
var exec = require('child_process').exec;
var program = require('commander');

// options

program
  .usage('[options] <name> [command]')
  .parse(process.argv);

// <name>

var name = program.args.shift();

if (!name) throw new Error('container <name> required');

// default command to a shell

var cmd = program.args;
if (0 == cmd.length) cmd = ['/bin/bash'];

// inspect

exec('docker inspect ' + name, function(err, stdout){
  if (err) throw err;

  // parse
  var obj = JSON.parse(stdout);
  var id = obj[0].ID;

  // attach
  var proc = spawn('lxc-attach', ['-n', id].concat(cmd), { stdio: 'inherit' });
});
